<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contando Moeda - Gerador de Roteiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide-react@0.292.0/dist/umd/lucide.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .loader {
            border-top-color: #4f46e5;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn.active {
            color: #4f46e5;
            border-color: #4f46e5;
        }
        [data-lucide] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-3xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Contando Moeda</h1>
            <p class="text-lg text-gray-600 mt-2">Porque a grana é pouca, mas o mundo é gigante</p>
        </header>

        <!-- Formulário de Input -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <form id="roteiro-form" class="space-y-4">
                <div>
                    <label for="destino" class="block text-sm font-medium text-gray-700 mb-1">Destino</label>
                    <input type="text" id="destino" name="destino" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Ex: Lisboa, Portugal" required>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="dias" class="block text-sm font-medium text-gray-700 mb-1">Nº de Dias</label>
                        <input type="number" id="dias" name="dias" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Ex: 7" required>
                    </div>
                     <div>
                        <label for="data" class="block text-sm font-medium text-gray-700 mb-1">Data da Viagem</label>
                        <input type="month" id="data" name="data" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                </div>
                <div>
                    <button type="submit" id="submit-btn" class="w-full bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all transform hover:scale-105 flex items-center justify-center">
                        <span id="btn-text">Criar Roteiro Mágico</span>
                        <div id="btn-loader" class="hidden loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 ml-3" style="border-top-color: white;"></div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Feedback para o usuário -->
        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6" role="alert">
            <strong class="font-bold">Opa!</strong>
            <span class="block sm:inline">Algo deu errado. Tente de novo, talvez a gente se perdeu no caminho.</span>
        </div>


        <!-- Container dos Resultados -->
        <div id="resultado-roteiro" class="hidden">
            <!-- Header do resultado -->
             <div id="resultado-header" class="text-center mb-6"></div>
             <!-- Abas de Navegação -->
             <div class="bg-white rounded-lg shadow-sm mb-6 sticky top-2 z-10">
                 <nav id="tabs" class="flex justify-around border-b"></nav>
             </div>
             <!-- Conteúdo das Abas -->
             <div id="tab-contents" class="space-y-6"></div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            const today = new Date();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const year = today.getFullYear();
            document.getElementById('data').value = `${year}-${month}`;
        });

        const form = document.getElementById('roteiro-form');
        const resultadoDiv = document.getElementById('resultado-roteiro');
        const errorMessage = document.getElementById('error-message');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');


        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const destino = document.getElementById('destino').value;
            const dias = document.getElementById('dias').value;
            const dataViagem = document.getElementById('data').value;
            const [ano, mes] = dataViagem.split('-');

            resultadoDiv.classList.add('hidden');
            errorMessage.classList.add('hidden');
            submitBtn.disabled = true;
            btnText.textContent = 'Criando...';
            btnLoader.classList.remove('hidden');

            const prompt = `Crie um roteiro de viagem completo para ${dias} dias em ${destino}, para uma viagem em ${mes}/${ano}. A persona é um viajante económico.
A resposta DEVE ser um objeto JSON, sem formatação markdown.
O JSON deve ter a seguinte estrutura:
{
  "cidade": "string",
  "pais": "string",
  "estimativa_custo": { "moeda_local": "string", "valor_total_aproximado": "number", "detalhes": "string" },
  "checklist_bagagem": { "Roupas Essenciais": ["item1", "item2"], "Higiene": ["item1", "item2"], "Eletrônicos": ["item1", "item2"] },
  "sugestoes_hospedagem": [ { "nome": "string", "descricao": "string" } ],
  "dicas_economia": { "alimentacao": ["dica1", "dica2"], "lembrancinhas": ["dica1", "dica2"] },
  "roteiro_diario": [
    {
      "dia": "number",
      "titulo": "string",
      "atividades": ["atividade1", "atividade2", "atividade3"],
      "dica_logistica": "string",
      "tempo_respirar": "string"
    }
  ]
}
Responda apenas com o JSON.`;
            
            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = {
                  contents: chatHistory,
                  generationConfig: { responseMimeType: "application/json" }
                };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();

                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    const data = JSON.parse(result.candidates[0].content.parts[0].text);
                    displayRoteiro(data);
                } else {
                   throw new Error("Resposta da API veio vazia ou em formato inesperado.");
                }

            } catch (error) {
                console.error("Erro ao gerar roteiro:", error);
                errorMessage.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                btnText.textContent = 'Criar Roteiro Mágico';
                btnLoader.classList.add('hidden');
            }
        });

        function createMapLink(query, city) {
            const encodedQuery = encodeURIComponent(`${query}, ${city}`);
            return `https://www.google.com/maps/search/?api=1&query=${encodedQuery}`;
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        function displayRoteiro(data) {
            resultadoDiv.classList.remove('hidden');
            const headerDiv = document.getElementById('resultado-header');
            const tabsDiv = document.getElementById('tabs');
            const tabContentsDiv = document.getElementById('tab-contents');

            headerDiv.innerHTML = '';
            tabsDiv.innerHTML = '';
            tabContentsDiv.innerHTML = '';
            
            // Header do Roteiro
            headerDiv.innerHTML = `
                <h2 class="text-3xl font-bold text-gray-800">Seu Roteiro para ${data.cidade}</h2>
                <p class="text-md text-gray-500">Viagem de ${data.roteiro_diario.length} dias em ${document.getElementById('data').value.replace('-', '/')}</p>`;

            // -- Criar Abas e Conteúdos --
            
            // 1. Aba do Roteiro
            tabsDiv.innerHTML += `<button class="tab-btn flex-1 p-4 font-semibold border-b-2 border-transparent transition-colors" data-tab="roteiro"><i data-lucide="map"></i>Roteiro</button>`;
            let roteiroHtml = `<div id="tab-roteiro" class="tab-content space-y-6">`;
            data.roteiro_diario.forEach((dia, index) => {
                let atividadesHtml = '<ul class="space-y-3">';
                
                const atividadesDoDia = Array.isArray(dia.atividades) ? dia.atividades : [String(dia.atividades || "Nenhuma atividade especificada")];

                atividadesDoDia.forEach(atividade => {
                    atividadesHtml += `<li class="flex items-start"><i data-lucide="check-circle-2" class="text-green-500 mt-1 flex-shrink-0"></i><span>${atividade} <a href="${createMapLink(atividade, data.cidade)}" target="_blank" class="text-indigo-600 hover:underline text-sm ml-1">(Ver no mapa)</a></span></li>`;
                });
                atividadesHtml += '</ul>';

                roteiroHtml += `
                    <div class="bg-white p-6 rounded-2xl shadow-lg fade-in" style="animation-delay: ${index * 100}ms">
                        <h3 class="text-xl font-bold mb-4 text-indigo-700 flex items-center"><i data-lucide="calendar-days"></i>Dia ${dia.dia}: ${dia.titulo}</h3>
                        <div class="space-y-4">
                            <div><h4 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="list-checks"></i>Atividades do Dia</h4>${atividadesHtml}</div>
                            <div class="p-4 bg-indigo-50 rounded-lg"><h4 class="font-semibold flex items-center"><i data-lucide="bus"></i>Dica de Logística</h4><p class="text-gray-700 ml-7">${dia.dica_logistica}</p></div>
                            <div class="p-4 bg-emerald-50 rounded-lg"><h4 class="font-semibold flex items-center"><i data-lucide="coffee"></i>Tempo de Respirar</h4><p class="text-gray-700 ml-7">${dia.tempo_respirar}</p></div>
                        </div>
                    </div>`;
            });
            roteiroHtml += `</div>`;
            tabContentsDiv.innerHTML += roteiroHtml;

            // 2. Aba da Mala
            tabsDiv.innerHTML += `<button class="tab-btn flex-1 p-4 font-semibold border-b-2 border-transparent transition-colors" data-tab="mala"><i data-lucide="suitcase"></i>Mala</button>`;
            let checklistHtml = `<div id="tab-mala" class="tab-content"><div class="bg-white p-6 rounded-2xl shadow-lg space-y-4 fade-in">`;
            for (const categoria in data.checklist_bagagem) {
                checklistHtml += `<h4 class="font-semibold text-lg pt-2">${categoria}</h4><ul class="text-gray-700 space-y-2">`;
                const items = Array.isArray(data.checklist_bagagem[categoria]) ? data.checklist_bagagem[categoria] : [String(data.checklist_bagagem[categoria])];
                items.forEach(item => {
                    checklistHtml += `<li class="flex items-center"><i data-lucide="check" class="text-gray-400 w-4 h-4 mr-2"></i>${item}</li>`;
                });
                checklistHtml += `</ul>`;
            }
            checklistHtml += `</div></div>`;
            tabContentsDiv.innerHTML += checklistHtml;
            
            // 3. Aba de Dicas
            tabsDiv.innerHTML += `<button class="tab-btn flex-1 p-4 font-semibold border-b-2 border-transparent transition-colors" data-tab="dicas"><i data-lucide="piggy-bank"></i>Dicas</button>`;
            let dicasHtml = `<div id="tab-dicas" class="tab-content space-y-6">`;
            // Custo
            dicasHtml += `<div class="bg-white p-6 rounded-2xl shadow-lg fade-in"><h3 class="text-xl font-bold mb-3 flex items-center"><i data-lucide="wallet"></i>Estimativa de Custo</h3><p class="text-3xl font-bold text-indigo-600">${data.estimativa_custo.valor_total_aproximado} <span class="text-lg font-medium text-gray-500">${data.estimativa_custo.moeda_local}</span></p><p class="text-sm text-gray-500 mt-2">${data.estimativa_custo.detalhes}</p></div>`;
            // Hospedagem
            dicasHtml += `<div class="bg-white p-6 rounded-2xl shadow-lg fade-in" style="animation-delay: 100ms"><h3 class="text-xl font-bold mb-4 flex items-center"><i data-lucide="bed-double"></i>Sugestões de Hostels</h3><div class="space-y-4">`;
            data.sugestoes_hospedagem.forEach(hostel => {
                dicasHtml += `<div><h4 class="font-semibold">${hostel.nome}</h4><p class="text-sm text-gray-600">${hostel.descricao} <a href="${createMapLink('Hostel ' + hostel.nome, data.cidade)}" target="_blank" class="text-indigo-600 hover:underline">(Pesquisar)</a></p></div>`;
            });
            dicasHtml += `</div></div>`;
             // Economia
            dicasHtml += `<div class="bg-white p-6 rounded-2xl shadow-lg fade-in" style="animation-delay: 200ms"><h3 class="text-xl font-bold mb-4 flex items-center"><i data-lucide="lightbulb"></i>Dicas para Economizar</h4><div class="space-y-4"><div><h4 class="font-semibold text-lg flex items-center"><i data-lucide="utensils-crossed"></i>Comida</h4>`;
            const alimentacaoDicas = Array.isArray(data.dicas_economia.alimentacao) ? data.dicas_economia.alimentacao : [String(data.dicas_economia.alimentacao)];
            alimentacaoDicas.forEach(dica => {
                dicasHtml += `<p class="text-sm text-gray-600 ml-7">- ${dica}</p>`;
            });
            dicasHtml += `</div><div><h4 class="font-semibold text-lg flex items-center"><i data-lucide="gift"></i>Lembrancinhas</h4>`;
            const lembrancinhasDicas = Array.isArray(data.dicas_economia.lembrancinhas) ? data.dicas_economia.lembrancinhas : [String(data.dicas_economia.lembrancinhas)];
            lembrancinhasDicas.forEach(dica => {
                 dicasHtml += `<p class="text-sm text-gray-600 ml-7">- ${dica}</p>`;
            });
            dicasHtml += `</div></div></div>`;
            dicasHtml += `</div>`;
            tabContentsDiv.innerHTML += dicasHtml;

            // -- Lógica das Abas --
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchTab(btn.dataset.tab);
                });
            });
            
            // Ativar a primeira aba por padrão
            switchTab('roteiro');
            
            // Renderiza os ícones
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
    </script>
</body>
</html>
